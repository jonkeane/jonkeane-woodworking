/* nanogallery2 - v3.0.5 - 2021-07-04 */
/**!
 * @preserve nanogallery2 - FLICKR data provider
 * Homepage: http://nanogallery2.nanostudio.org
 * Sources:  https://github.com/nanostudio-org/nanogallery2
 *
 * License:  GPLv3 and commercial licence
 * 
*/
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","nanogallery2"],t):"object"==typeof exports&&"function"==typeof require?t(require(["jquery","nanogallery2"])):t(jQuery)}((function(t){jQuery.nanogallery2.data_flickr=function(t,e){var r=t,i={url:function(){return"https://api.flickr.com/services/rest/"},thumbSize:"               sq",thumbAvailableSizes:new Array(75,100,150,240,500,640),thumbAvailableSizesStr:new Array("sq","t","q","s","m","z"),photoSize:"0",photoAvailableSizes:new Array(75,100,150,240,500,640,1024,1024,1600,2048,1e4),photoAvailableSizesStr:new Array("sq","t","q","s","m","z","b","l","h","k","o")},o=function(t,e,o,l){""==r.O.flickrAPIKey&&f(r,"Please set your Flickr API Key (option flickrAPIKey)");var s=NGY2Item.GetIdx(r,t),u="",p="image";"NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase()?u=i.url()+"?&method=flickr.people.getPublicPhotos&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_z,url_b,url_h,url_k&per_page=500&format=json":0==r.I[s].GetID()?(u=i.url()+"?&method=flickr.photosets.getList&api_key="+r.O.flickrAPIKey+"&user_id="+r.O.userID+"&per_page=500&primary_photo_extras=tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",p="album"):u=i.url()+"?&method=flickr.photosets.getPhotos&api_key="+r.O.flickrAPIKey+"&photoset_id="+r.I[s].GetID()+"&extras=description,views,tags,url_o,url_sq,url_t,url_q,url_s,url_m,url_l,url_z,url_b,url_h,url_k&format=json",r.O.debugMode&&console.log("Flickr URL: "+u),c(!0),jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var g=setTimeout((function(){c(!1),f(r,"Could not retrieve AJAX data...")}),6e4),_=[],d=function(i,u){jQuery.getJSON(i+"&page="+u+"&jsoncallback=?",(function(x,v,b){var y=0;if("album"==p){if(void 0!==x.stat&&"fail"===x.stat)return f(r,"Could not retrieve Flickr album list: "+x.message+" (code: "+x.code+")."),!1;_=_.concat(x.photosets.photoset),y=x.photosets.pages}else if("NONE"==r.O.photoset.toUpperCase()||"NONE"==r.O.album.toUpperCase())_=_.concat(x.photos.photo),y=x.photos.pages;else{if(void 0!==x.stat&&"fail"===x.stat)return f(r,"Could not retrieve Flickr album: "+x.message+" (code: "+x.code+")."),!1;""==r.I[s].title&&(r.I[s].title=x.photoset.title),_=_.concat(x.photoset.photo),y=x.photoset.pages}y>u?d(i,u+1):(clearTimeout(g),c(!1),_=h(_,r.O.tagBlockList),"album"==p?n(s,t,_):a(s,t,_),m(t),null!=e&&e(o,l,null))})).fail((function(t,e,i){clearTimeout(g),c(!1),f(r,"Could not retrieve Flickr ajax data: "+e+", "+i)}))};d(u,1)};function l(t,e){jQuery.ajaxSetup({cache:!1}),jQuery.support.cors=!0;var o=setTimeout((function(){f("Could not retrieve AJAX data...")}),6e4);url=i.url()+"?&method=flickr.photos.getExif&api_key="+r.O.flickrAPIKey+"&photo_id="+t+"&format=json",jQuery.getJSON(url+"&jsoncallback=?",(function(t,r,i){void 0!==t.photo.camera&&(e.exif.model=t.photo.camera);var l=t.photo.exif.filter((function(t){return"LensModel"==t.tag}));l.length>=1&&(e.exif.lens=l[0].raw._content);var a=t.photo.exif.filter((function(t){return"Flash"==t.tag}));a.length>=1&&(e.exif.flash=a[0].raw._content);var n=t.photo.exif.filter((function(t){return"FocalLength"==t.tag}));n.length>=1&&(e.exif.focallength=n[0].raw._content);var s=t.photo.exif.filter((function(t){return"FNumber"==t.tag}));s.length>=1&&(e.exif.fstop=s[0].raw._content);var u=t.photo.exif.filter((function(t){return"ExposureTime"==t.tag}));u.length>=1&&(e.exif.exposure=u[0].raw._content);var h=t.photo.exif.filter((function(t){return"ISO"==t.tag}));h.length>=1&&(e.exif.iso=h[0].raw._content);var c=t.photo.exif.filter((function(t){return"DateTimeOriginal"==t.tag}));c.length>=1&&(e.exif.time=c[0].raw._content);var f=t.photo.exif.filter((function(t){return"LOLcation"==t.tag}));f.length>=1&&(e.exif.location=f[0].raw._content);var p=t.photo.exif.filter((function(t){return"OwnerName"==t.tag}));p.length>=1&&(e.author=p[0].raw._content),clearTimeout(o)})).fail((function(t,e,r){console.log("Unable to get EXIF data from Flickr")}))}function a(t,e,o){r.O.debugMode&&(console.log("Flickr parse photos:"),console.dir(o)),jQuery.each(o,(function(t,o){var a=o.id,n=o.url_sq,u=o.title;""!=r.O.thumbnailLabel.get("title")&&(u=p(n));var h=o.description._content,c=75,f=75,g=i.photoAvailableSizesStr.length-1;r.O.flickrSkipOriginal&&g--;for(t=g;t>=0;t--)if(null!=o["url_"+i.photoAvailableSizesStr[t]]){n=o["url_"+i.photoAvailableSizesStr[t]],c=parseInt(o["width_"+i.photoAvailableSizesStr[t]]),f=parseInt(o["height_"+i.photoAvailableSizesStr[t]]);break}var m={};for(var _ in o)0!=_.indexOf("height_")&&0!=_.indexOf("width_")&&0!=_.indexOf("url_")||(m[_]=o[_]);var d=void 0!==o.tags?o.tags:"",x=NGY2Item.New(r,u,h,a,e,"image",d);r.O.flickrExif&&l(a,x),x.setMediaURL(n,"img"),x.imageWidth=c,x.imageHeight=f;var v={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};v=s(v,o,"l1"),v=s(v,o,"lN"),x.thumbs=v;var b=r.O.fnProcessData;null!==b&&("function"==typeof b?b(x,"flickr",o):window[b](x,"flickr",o))})),r.I[t].contentIsLoaded=!0}function n(t,e,i){r.O.debugMode&&(console.log("Flickr parse list of albums:"),console.dir(i)),jQuery.each(i,(function(t,i){var o=i.title._content;if(0==i.visibility_can_see_set)return!0;if(g(o,i.id)){var l=i.id,a=null!=i.description._content?i.description._content:"",n={};for(var u in i.primary_photo_extras)n[u]=i.primary_photo_extras[u];var h="";void 0!==i.primary_photo_extras&&void 0!==i.primary_photo_extras.tags&&(h=i.primary_photo_extras.tags);var c=NGY2Item.New(r,o,a,l,e,"album",h);c.numberItems=i.photos,c.thumbSizes=n;var f={url:{l1:{xs:"",sm:"",me:"",la:"",xl:""},lN:{xs:"",sm:"",me:"",la:"",xl:""}},width:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}},height:{l1:{xs:0,sm:0,me:0,la:0,xl:0},lN:{xs:0,sm:0,me:0,la:0,xl:0}}};f=s(f,i.primary_photo_extras,"l1"),f=s(f,i.primary_photo_extras,"lN"),c.thumbs=f;var p=r.O.fnProcessData;null!==p&&("function"==typeof p?p(c,"flickr",i):window[p](c,"flickr",i))}})),r.I[t].contentIsLoaded=!0}function s(t,e,i){var o=1;!0===r.tn.opt[i].crop&&(o=r.O.thumbnailCropScaleFactor);for(var l=["xs","sm","me","la","xl"],a=0;a<l.length;a++)if("auto"==r.tn.settings.width[i][l[a]]||""==r.tn.settings.width[i][l[a]]){let n=u("height_",Math.ceil(r.tn.settings.height[i][l[a]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].h[l[a]]),e);t.url[i][l[a]]=n.url,t.width[i][l[a]]=n.width,t.height[i][l[a]]=n.height}else if("auto"==r.tn.settings.height[i][l[a]]||""==r.tn.settings.height[i][l[a]]){let n=u("width_",Math.ceil(r.tn.settings.width[i][l[a]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].w[l[a]]),e);t.url[i][l[a]]=n.url,t.width[i][l[a]]=n.width,t.height[i][l[a]]=n.height}else{let n="height_",s=Math.ceil(r.tn.settings.height[i][l[a]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].h[l[a]]);r.tn.settings.width[i][l[a]]>r.tn.settings.height[i][l[a]]&&(n="width_",s=Math.ceil(r.tn.settings.width[i][l[a]]*r.tn.scale*o*r.tn.settings.mosaic[i+"Factor"].w[l[a]]));let h=u(n,s,e);t.url[i][l[a]]=h.url,t.width[i][l[a]]=h.width,t.height[i][l[a]]=h.height}return t}function u(t,e,r){for(var o={url:"",width:0,height:0},l=0,a=0;a<i.thumbAvailableSizes.length;a++){var n=r[t+i.photoAvailableSizesStr[a]];if(null!=n&&(l=a,n>=e))break}var s=i.photoAvailableSizesStr[l];return o.url=r["url_"+s],o.width=parseInt(r["width_"+s]),o.height=parseInt(r["height_"+s]),o}var h=function(t,e){return""!=e&&null!=t&&(t=t.filter((function(t){var r=new RegExp(e,"i"),i=[t.tags];return Array.isArray(t.tags)&&(i=t.tags),!i.some((function(t){return r.test(t)}))}))),t};var c=NGY2Tools.PreloaderDisplay.bind(r),f=NGY2Tools.NanoAlert,p=NGY2Tools.GetImageTitleFromURL.bind(r),g=NGY2Tools.FilterAlbumName.bind(r),m=NGY2Tools.AlbumPostProcess.bind(r);switch(e){case"AlbumGetContent":var _=arguments[2],d=arguments[3],x=arguments[4],v=arguments[5];o(_,d,x,v)}}}));